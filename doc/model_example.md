---
title: "Model objects"
author: "Dr Gavin Rhys Lloyd"
package: structToolbox
output: 
    html_document:
        keep_md: true
    md_document:
        variant: markdown_github
        df_print: kable
        html_preview: false
vignette: >
  %\VignetteIndexEntry{Model objects}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---



</br></br>

# Introduction
PCA (Principal Component Analysis) is a commonly applied method for exploring multivariate datasets. We will use the iris dataset as an example, which is included in the package and already prepared as a dataset object.


```r
D = iris_dataset()
D$data
#>     Sepal.Length Sepal.Width Petal.Length Petal.Width
#> 1            5.1         3.5          1.4         0.2
#> 2            4.9         3.0          1.4         0.2
#> 3            4.7         3.2          1.3         0.2
#> 4            4.6         3.1          1.5         0.2
#> 5            5.0         3.6          1.4         0.2
#> 6            5.4         3.9          1.7         0.4
#> 7            4.6         3.4          1.4         0.3
#> 8            5.0         3.4          1.5         0.2
#> 9            4.4         2.9          1.4         0.2
#> 10           4.9         3.1          1.5         0.1
#> 11           5.4         3.7          1.5         0.2
#> 12           4.8         3.4          1.6         0.2
#> 13           4.8         3.0          1.4         0.1
#> 14           4.3         3.0          1.1         0.1
#> 15           5.8         4.0          1.2         0.2
#> 16           5.7         4.4          1.5         0.4
#> 17           5.4         3.9          1.3         0.4
#> 18           5.1         3.5          1.4         0.3
#> 19           5.7         3.8          1.7         0.3
#> 20           5.1         3.8          1.5         0.3
#> 21           5.4         3.4          1.7         0.2
#> 22           5.1         3.7          1.5         0.4
#> 23           4.6         3.6          1.0         0.2
#> 24           5.1         3.3          1.7         0.5
#> 25           4.8         3.4          1.9         0.2
#> 26           5.0         3.0          1.6         0.2
#> 27           5.0         3.4          1.6         0.4
#> 28           5.2         3.5          1.5         0.2
#> 29           5.2         3.4          1.4         0.2
#> 30           4.7         3.2          1.6         0.2
#> 31           4.8         3.1          1.6         0.2
#> 32           5.4         3.4          1.5         0.4
#> 33           5.2         4.1          1.5         0.1
#> 34           5.5         4.2          1.4         0.2
#> 35           4.9         3.1          1.5         0.2
#> 36           5.0         3.2          1.2         0.2
#> 37           5.5         3.5          1.3         0.2
#> 38           4.9         3.6          1.4         0.1
#> 39           4.4         3.0          1.3         0.2
#> 40           5.1         3.4          1.5         0.2
#> 41           5.0         3.5          1.3         0.3
#> 42           4.5         2.3          1.3         0.3
#> 43           4.4         3.2          1.3         0.2
#> 44           5.0         3.5          1.6         0.6
#> 45           5.1         3.8          1.9         0.4
#> 46           4.8         3.0          1.4         0.3
#> 47           5.1         3.8          1.6         0.2
#> 48           4.6         3.2          1.4         0.2
#> 49           5.3         3.7          1.5         0.2
#> 50           5.0         3.3          1.4         0.2
#> 51           7.0         3.2          4.7         1.4
#> 52           6.4         3.2          4.5         1.5
#> 53           6.9         3.1          4.9         1.5
#> 54           5.5         2.3          4.0         1.3
#> 55           6.5         2.8          4.6         1.5
#> 56           5.7         2.8          4.5         1.3
#> 57           6.3         3.3          4.7         1.6
#> 58           4.9         2.4          3.3         1.0
#> 59           6.6         2.9          4.6         1.3
#> 60           5.2         2.7          3.9         1.4
#> 61           5.0         2.0          3.5         1.0
#> 62           5.9         3.0          4.2         1.5
#> 63           6.0         2.2          4.0         1.0
#> 64           6.1         2.9          4.7         1.4
#> 65           5.6         2.9          3.6         1.3
#> 66           6.7         3.1          4.4         1.4
#> 67           5.6         3.0          4.5         1.5
#> 68           5.8         2.7          4.1         1.0
#> 69           6.2         2.2          4.5         1.5
#> 70           5.6         2.5          3.9         1.1
#> 71           5.9         3.2          4.8         1.8
#> 72           6.1         2.8          4.0         1.3
#> 73           6.3         2.5          4.9         1.5
#> 74           6.1         2.8          4.7         1.2
#> 75           6.4         2.9          4.3         1.3
#> 76           6.6         3.0          4.4         1.4
#> 77           6.8         2.8          4.8         1.4
#> 78           6.7         3.0          5.0         1.7
#> 79           6.0         2.9          4.5         1.5
#> 80           5.7         2.6          3.5         1.0
#> 81           5.5         2.4          3.8         1.1
#> 82           5.5         2.4          3.7         1.0
#> 83           5.8         2.7          3.9         1.2
#> 84           6.0         2.7          5.1         1.6
#> 85           5.4         3.0          4.5         1.5
#> 86           6.0         3.4          4.5         1.6
#> 87           6.7         3.1          4.7         1.5
#> 88           6.3         2.3          4.4         1.3
#> 89           5.6         3.0          4.1         1.3
#> 90           5.5         2.5          4.0         1.3
#> 91           5.5         2.6          4.4         1.2
#> 92           6.1         3.0          4.6         1.4
#> 93           5.8         2.6          4.0         1.2
#> 94           5.0         2.3          3.3         1.0
#> 95           5.6         2.7          4.2         1.3
#> 96           5.7         3.0          4.2         1.2
#> 97           5.7         2.9          4.2         1.3
#> 98           6.2         2.9          4.3         1.3
#> 99           5.1         2.5          3.0         1.1
#> 100          5.7         2.8          4.1         1.3
#> 101          6.3         3.3          6.0         2.5
#> 102          5.8         2.7          5.1         1.9
#> 103          7.1         3.0          5.9         2.1
#> 104          6.3         2.9          5.6         1.8
#> 105          6.5         3.0          5.8         2.2
#> 106          7.6         3.0          6.6         2.1
#> 107          4.9         2.5          4.5         1.7
#> 108          7.3         2.9          6.3         1.8
#> 109          6.7         2.5          5.8         1.8
#> 110          7.2         3.6          6.1         2.5
#> 111          6.5         3.2          5.1         2.0
#> 112          6.4         2.7          5.3         1.9
#> 113          6.8         3.0          5.5         2.1
#> 114          5.7         2.5          5.0         2.0
#> 115          5.8         2.8          5.1         2.4
#> 116          6.4         3.2          5.3         2.3
#> 117          6.5         3.0          5.5         1.8
#> 118          7.7         3.8          6.7         2.2
#> 119          7.7         2.6          6.9         2.3
#> 120          6.0         2.2          5.0         1.5
#> 121          6.9         3.2          5.7         2.3
#> 122          5.6         2.8          4.9         2.0
#> 123          7.7         2.8          6.7         2.0
#> 124          6.3         2.7          4.9         1.8
#> 125          6.7         3.3          5.7         2.1
#> 126          7.2         3.2          6.0         1.8
#> 127          6.2         2.8          4.8         1.8
#> 128          6.1         3.0          4.9         1.8
#> 129          6.4         2.8          5.6         2.1
#> 130          7.2         3.0          5.8         1.6
#> 131          7.4         2.8          6.1         1.9
#> 132          7.9         3.8          6.4         2.0
#> 133          6.4         2.8          5.6         2.2
#> 134          6.3         2.8          5.1         1.5
#> 135          6.1         2.6          5.6         1.4
#> 136          7.7         3.0          6.1         2.3
#> 137          6.3         3.4          5.6         2.4
#> 138          6.4         3.1          5.5         1.8
#> 139          6.0         3.0          4.8         1.8
#> 140          6.9         3.1          5.4         2.1
#> 141          6.7         3.1          5.6         2.4
#> 142          6.9         3.1          5.1         2.3
#> 143          5.8         2.7          5.1         1.9
#> 144          6.8         3.2          5.9         2.3
#> 145          6.7         3.3          5.7         2.5
#> 146          6.7         3.0          5.2         2.3
#> 147          6.3         2.5          5.0         1.9
#> 148          6.5         3.0          5.2         2.0
#> 149          6.2         3.4          5.4         2.3
#> 150          5.9         3.0          5.1         1.8
```
 
</br></br>

# PCA model
Before we apply PCA we first need to create a PCA object. This object contains all the inputs, outputs and methods needed to apply PCA. We can set parameters such as the number of components when the PCA model is created, but we can also use dollar notation to change/view it later. 


```r
P = PCA(number_components=15)
P$number_components=5
P$number_components
#> [1] 5
```
  
The inputs for a model can be listed using `param.ids(object)`:


```r
param.ids(P)
#> [1] "number_components"
```
</br></br>

# Model sequences
Unless you have very good reason not to, it is usally sensible to mean centre the columns of the data before PCA. Using the `STRUCT` framework we can create a model sequence that will mean centre and then apply PCA to the mean centred data.


```r
M = mean_centre() + PCA(number_components = 4)
```
  
In `STRUCT` mean centring and PCA are both model objects, and therefore joining them creates a model.sequence object. The objects in the sequence can be accessed by indexing, and we can combine this with dollar notation. For example, the PCA object is the second object in our sequence and we can access the number of components like this:


```r
M[2]$number_components
#> [1] 4
```
</br></br>

# Training/testing models
Model and model.sequence objects need to be trained using a training dataset.


```r
M = model.train(M,D)
```
  
Model objects can be used to generate predictions for test datasets. For this example we will just use the training data (sometimes called autoprediction).


```r
M = model.predict(M,D)
```

The available outputs for an object can be listed and accessed using dollar notation:
  

```r
output.ids(M[2])
#> [1] "scores"      "loadings"    "eigenvalues" "ssx"         "correlation"
#> [6] "that"
M[2]$scores
#>              PC1          PC2          PC3           PC4
#> 1   -2.684125626 -0.319397247  0.027914828  0.0022624371
#> 2   -2.714141687  0.177001225  0.210464272  0.0990265503
#> 3   -2.888990569  0.144949426 -0.017900256  0.0199683897
#> 4   -2.745342856  0.318298979 -0.031559374 -0.0755758166
#> 5   -2.728716537 -0.326754513 -0.090079241 -0.0612585926
#> 6   -2.280859633 -0.741330449 -0.168677658 -0.0242008576
#> 7   -2.820537751  0.089461385 -0.257892158 -0.0481431065
#> 8   -2.626144973 -0.163384960  0.021879318 -0.0452978706
#> 9   -2.886382732  0.578311754 -0.020759570 -0.0267447358
#> 10  -2.672755798  0.113774246  0.197632725 -0.0562954013
#> 11  -2.506947091 -0.645068899  0.075318009 -0.0150199245
#> 12  -2.612755231 -0.014729939 -0.102150260 -0.1563792078
#> 13  -2.786109266  0.235112000  0.206844430 -0.0078879115
#> 14  -3.223803744  0.511394587 -0.061299672 -0.0216798118
#> 15  -2.644750390 -1.178764636  0.151627524  0.1592097177
#> 16  -2.386039034 -1.338062330 -0.277776903  0.0065515459
#> 17  -2.623527875 -0.810679514 -0.138183228  0.1677347372
#> 18  -2.648296706 -0.311849145 -0.026668316  0.0776281796
#> 19  -2.199820324 -0.872839039  0.120305523  0.0270518681
#> 20  -2.587986400 -0.513560309 -0.213665172 -0.0662726502
#> 21  -2.310256215 -0.391345936  0.239444043 -0.0150707908
#> 22  -2.543705229 -0.432996063 -0.208457232  0.0410654027
#> 23  -3.215939416 -0.133468070 -0.292396751  0.0044821251
#> 24  -2.302733182 -0.098708855 -0.039123259  0.1483525893
#> 25  -2.355754049  0.037281860 -0.125021083 -0.3003309039
#> 26  -2.506668907  0.146016880  0.253420042  0.0346074722
#> 27  -2.468820073 -0.130951489 -0.094910576  0.0574497158
#> 28  -2.562319906 -0.367718857  0.078494205 -0.0141727423
#> 29  -2.639534715 -0.312039980  0.145908896  0.0657834667
#> 30  -2.631989387  0.196961225 -0.040771079 -0.1239833064
#> 31  -2.587398477  0.204318491  0.077222989 -0.0604622767
#> 32  -2.409932497 -0.410924264  0.145524972  0.2316284917
#> 33  -2.648862334 -0.813363820 -0.225669150 -0.2813723471
#> 34  -2.598736749 -1.093145759 -0.157810813 -0.0953488583
#> 35  -2.636926878  0.121322348  0.143049582  0.0190703413
#> 36  -2.866241652 -0.069364472  0.164332307  0.1625984463
#> 37  -2.625238050 -0.599370021  0.268350376  0.1764412129
#> 38  -2.800684115 -0.268643738 -0.093699082 -0.1681730544
#> 39  -2.980502044  0.487958344 -0.072927046 -0.0107331474
#> 40  -2.590006314 -0.229043837  0.080082303 -0.0137491513
#> 41  -2.770102426 -0.263527534 -0.077247693  0.0940633590
#> 42  -2.849368705  0.940960574  0.349230377  0.3199874870
#> 43  -2.997406547  0.341926057 -0.192509212 -0.0746777682
#> 44  -2.405614485 -0.188871429 -0.263867946  0.1762088905
#> 45  -2.209489238 -0.436663142 -0.298742746 -0.1828425025
#> 46  -2.714451427  0.250208204  0.097678144  0.1428435736
#> 47  -2.538148259 -0.503771144 -0.166705637 -0.1896222914
#> 48  -2.839462168  0.227945569 -0.083726849 -0.0595642283
#> 49  -2.543085750 -0.579410022  0.017115024 -0.0465686438
#> 50  -2.703359782 -0.107706082  0.089294008  0.0346583385
#> 51   1.284825689 -0.685160470  0.406568025  0.0185252879
#> 52   0.932488532 -0.318333638  0.018014187  0.0005665121
#> 53   1.464302322 -0.504262815  0.338325765 -0.0016531759
#> 54   0.183317720  0.827959012  0.179591392  0.0935668402
#> 55   1.088103258 -0.074590675  0.307757896  0.1120205742
#> 56   0.641669084  0.418246872 -0.041076091 -0.2431167665
#> 57   1.095060663 -0.283468270 -0.169810240 -0.0835565724
#> 58  -0.749122670  1.004890961 -0.012302919 -0.0179077226
#> 59   1.044131826 -0.228361900  0.415336085 -0.0391345020
#> 60  -0.008745404  0.723081905 -0.281141431 -0.0056189179
#> 61  -0.507840884  1.265971191  0.269817183  0.0455624408
#> 62   0.511698557  0.103981235 -0.130547750  0.0507192325
#> 63   0.264976508  0.550036464  0.694146830  0.0571855195
#> 64   0.984934510  0.124817854  0.062114408 -0.1694962546
#> 65  -0.173925372  0.254854209 -0.090457691  0.1252172921
#> 66   0.927860781 -0.467179494  0.314620976  0.0998031365
#> 67   0.660283762  0.352969666 -0.328027528 -0.1878786215
#> 68   0.236104993  0.333610767  0.271161837 -0.2137573696
#> 69   0.944733728  0.543145551  0.499519046  0.2571921772
#> 70   0.045226976  0.583834377  0.235002105 -0.0415766476
#> 71   1.116283177  0.084616852 -0.459620991 -0.0750315529
#> 72   0.357888418  0.068925032  0.229853888  0.1229976041
#> 73   1.298183875  0.327787308  0.347854352  0.0008883706
#> 74   0.921728922  0.182737794  0.231071778 -0.2882554293
#> 75   0.714853326 -0.149055944  0.321800937  0.0417197556
#> 76   0.900174373 -0.328504474  0.316209074  0.1002267276
#> 77   1.332024437 -0.244440876  0.521702780  0.0353331921
#> 78   1.557802155 -0.267495447  0.164920984  0.0699692823
#> 79   0.813290650  0.163350301 -0.035424505 -0.0297114340
#> 80  -0.305583778  0.368262190  0.318491581  0.0745696136
#> 81  -0.068126492  0.705172132  0.244213810  0.0068308422
#> 82  -0.189622472  0.680286764  0.306420561 -0.0205510016
#> 83   0.136428712  0.314032438  0.177242766  0.0329419128
#> 84   1.380026436  0.420954287 -0.016167128 -0.1783044629
#> 85   0.588006443  0.484287420 -0.444433499 -0.2509760601
#> 86   0.806858313 -0.194182315 -0.388963063 -0.1142072433
#> 87   1.220690882 -0.407619594  0.237167010  0.0312171829
#> 88   0.815095236  0.372037060  0.614720843  0.1540209998
#> 89   0.245957680  0.268524397 -0.188366812 -0.1466745117
#> 90   0.166413217  0.681926725  0.060009226  0.0296222195
#> 91   0.464800288  0.670711545  0.024306856 -0.2696514282
#> 92   0.890815198  0.034464444  0.009946933 -0.1534846663
#> 93   0.230548024  0.404385848  0.229410241  0.0169303245
#> 94  -0.704531759  1.012248228  0.105691149  0.0456133071
#> 95   0.356981495  0.504910093 -0.016617170 -0.0987414793
#> 96   0.331934480  0.212654684 -0.083204291 -0.2384754337
#> 97   0.376215651  0.293218929 -0.077996351 -0.1311373808
#> 98   0.642576008 -0.017738190  0.205394967 -0.0213776830
#> 99  -0.906469865  0.756093367  0.012599648  0.2325348443
#> 100  0.299000842  0.348897806 -0.010581660 -0.0511811717
#> 101  2.531192728  0.009849109 -0.760165427 -0.0290555728
#> 102  1.415235877  0.574916348 -0.296322527 -0.0153046739
#> 103  2.616676016 -0.343903151  0.110787883  0.0657720412
#> 104  1.971531053  0.179727904 -0.108424662 -0.2367909342
#> 105  2.350005920  0.040260947 -0.285389563 -0.0001706333
#> 106  3.397038736 -0.550836673  0.348437556 -0.1123716532
#> 107  0.521232244  1.192758727 -0.545659296 -0.0981266196
#> 108  2.932587069 -0.355500003  0.420239936 -0.2571910322
#> 109  2.321228817  0.243831502  0.348304395 -0.0786746130
#> 110  2.916750967 -0.782791949 -0.423335418  0.1109820710
#> 111  1.661774154 -0.242228408 -0.242440190  0.1210405518
#> 112  1.803401953  0.215637617  0.037648168  0.0780198444
#> 113  2.165591796 -0.216275585 -0.033326642  0.1630614782
#> 114  1.346163579  0.776818347 -0.281902882  0.1404408688
#> 115  1.585928224  0.539640714 -0.629029326  0.3295517284
#> 116  1.904456375 -0.119250692 -0.479639820  0.2196212627
#> 117  1.949689059 -0.041943260 -0.044186168 -0.1576819073
#> 118  3.487055364 -1.175739330 -0.133894874 -0.3092195730
#> 119  3.795645422 -0.257322973  0.513767764  0.0538460965
#> 120  1.300791713  0.761149636  0.344995038 -0.0458247549
#> 121  2.427817913 -0.378196013 -0.219119324  0.1854292644
#> 122  1.199001105  0.606091528 -0.511855509  0.0609591171
#> 123  3.499920039 -0.460674099  0.573182243 -0.1402279544
#> 124  1.388766132  0.204399327  0.064522757  0.1630409774
#> 125  2.275430504 -0.334990606 -0.286150091 -0.0603719696
#> 126  2.614090474 -0.560901355  0.205534524 -0.2407049865
#> 127  1.258508161  0.179704795 -0.045847704  0.1475038465
#> 128  1.291132059  0.116668651 -0.231256463  0.0040266077
#> 129  2.123608723  0.209729477 -0.154180024  0.0528273230
#> 130  2.388003016 -0.464639805  0.449530192 -0.2315240534
#> 131  2.841672778 -0.375269167  0.498898076 -0.0223364626
#> 132  3.230673661 -1.374165087  0.114548205 -0.2529019234
#> 133  2.159437642  0.217277579 -0.208763167  0.1281930656
#> 134  1.444161242  0.143413410  0.153233888 -0.1909963579
#> 135  1.781294810  0.499901681  0.172875189 -0.5054344118
#> 136  3.076499932 -0.688085678  0.335592292  0.3098280446
#> 137  2.144243314 -0.140064201 -0.734878937  0.0555419691
#> 138  1.905098149 -0.049300526 -0.162180236 -0.2212029369
#> 139  1.169326339  0.164990262 -0.281835840  0.0204617872
#> 140  2.107611143 -0.372287872 -0.027291132  0.2106217858
#> 141  2.314154705 -0.183651279 -0.322693747  0.2776537774
#> 142  1.922267801 -0.409203467 -0.113586596  0.5053049669
#> 143  1.415235877  0.574916348 -0.296322527 -0.0153046739
#> 144  2.563013375 -0.277862603 -0.292569525  0.0579127477
#> 145  2.418746183 -0.304798198 -0.504482664  0.2410910005
#> 146  1.944109795 -0.187532303 -0.177825091  0.4261959400
#> 147  1.527166615  0.375316983  0.121898172  0.2543674420
#> 148  1.764345717 -0.078858855 -0.130481631  0.1370012739
#> 149  1.900941614 -0.116627959 -0.723251563  0.0445953047
#> 150  1.390188862  0.282660938 -0.362909648 -0.1550386282
```
</br></br>

# Model charts
The struct framework includes charts. Charts associated with a model object can be listed.


```r
chart.names(M[2])
#> [1] "PCA.dstat"            "PCA.scree"            "pca_biplot_plot"     
#> [4] "pca_correlation_plot" "pca_loadings_plot"    "pca_scores_plot"
```
  
Like model objects, chart objects need to be created before they can be used. Here we will plot the PCA scores plot for our mean centred PCA model.


```r
C = pca_scores_plot(groups=D$sample_meta$Species,factor_name='Species') # colour by Species
chart.plot(C,M[2])
```

<img src="model_example_files/figure-html/unnamed-chunk-10-1.png" style="display: block; margin: auto;" />
  
If we makes changes to our chart object, we must call `chart.plot` again.


```r
C$groups = D$data$Petal.Width
C$factor_name='Petal.Width'
chart.plot(C,M[2])
```

<img src="model_example_files/figure-html/unnamed-chunk-11-1.png" style="display: block; margin: auto;" />
  
The `chart.plot` method can return e.g. a ggplot object so that you can easily combine it with other plots using the gridExtra package for example.


```r
C1 = pca_scores_plot(groups=D$sample_meta$Species,factor_name='Species') # colour by Species
g1 = chart.plot(C1,M[2])
C2 = PCA.scree()
g2 = chart.plot(C2,M[2])
grid.arrange(grobs=list(g1,g2),nrow=1)
```

<img src="model_example_files/figure-html/unnamed-chunk-12-1.png" style="display: block; margin: auto;" />
</br></br>

# STATO Integration
Some model objects are also STATO objects. STATO is a general purpose statistics ontology (http://stato-ontology.org/). In the `STRUCT` framework we use it to provide standarded definitions for objects. The PCA model object is also a STATO object.


```r
is(PCA(),'stato')
#> [1] TRUE
```

We can access the STATO ontology using some methods specific to stato objects.


```r
# this is the stato id for PCA
stato.id(P)
#> [1] "OBI:0200051"

# this is the stato name
stato.name(P)
#> [1] "principal components analysis dimensionality reduction"

# this is the stato definition
stato.definition(P)
#> [1] "A principal components analysis dimensionality reduction is a dimensionality reduction achieved by applying principal components analysis and by keeping low-order principal components and excluding higher-order ones. "
```

This information is more succinctly displayed using `stato.summary`. This method also scans over all inputs and outputs for those with STATO definitions and displays those as well. For PCA the number of components is present, but none of the outputs are STATO objects and therefore no definition is provided.


```r
stato.summary(P)
#> OBI:0200051 
#> principal components analysis dimensionality reduction 
#> A principal components analysis dimensionality reduction is a dimensionality reduction achieved by applying principal components analysis and by keeping low-order principal components and excluding higher-order ones.  
#> 
#> Inputs:
#> STATO:0000555 
#> number of predictive components 
#> number of predictive components is a count used as input to the principle component analysis (PCA)  
#> 
#> 
#> Outputs:
```



